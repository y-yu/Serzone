<html lang="jp">
<head>
    <meta charset="utf-8" />
    <title>Serzone.js</title>
    
	<meta name="author" content="yoshimuraYuu" />
	<link href="css/default.css" rel="stylesheet" />
</head>
<body>
<script>
var Serzone = {};
Serzone.action = {};

function arrayify (e) {
	return Array.prototype.slice.call(e);
}

function makeIndex (slide, now) {
	if (slide.body.getElementsByClassName("indexTable")[0] != undefined) {
		slide.body.removeChild( slide.body.getElementsByClassName("indexTable")[0] );
	}

	var table = document.createElement("table");
	table.appendChild(
		slide.children.map( function (s) {
			var td = document.createElement("td");

			if (s.order <= now) {
				td.appendChild(s.body);
			} else {
				td.appendChild( s.body.getElementsByTagName("h1")[0].cloneNode(true) );
			}

			return td;
		}).reduce( (function(x, y) {
			if (x[x.length - 1].length < 2) {
				x[x.length - 1].push(y);
			} else {
				x.push([y]);
			}

			return x;
		}), [[]]).reduce( (function (tbody, tds) {
			var tr = tds.reduce( (function (x, y) {
				x.appendChild(y);
				return x;
			}), document.createElement("tr") );

			tbody.appendChild(tr);
			return tbody;
		}),	document.createElement("tbody")) );

	table.classList.add("indexTable");

	table.style.marginTop = "30px";
	table.style.marginBottom = "10px";

	return table;
}

function getOffset (e) {
	var x = 0,
		y = 0;

	while (e != null) {
		x += e.offsetLeft;
		y += e.offsetTop;

		e = e.offsetParent;
	}

	return { x : x, y : y };
}

Serzone.action = {
	changeSlide : {
		type : "next",
		init : function (o) {
			var slide = o.obj;

			if (slide.order == 0) {
				document.body.removeChild( document.getElementById("serzone") );
				Serzone.canvas.style.webkitTransition = "all 1s ease-in-out 0ms";
			}

			if (slide.children.length == 0) {
				if (slide.depth > 0) {
					var parent = slide.parent.body.parentNode;
					var table = makeIndex(slide.parent, slide.order);

					parent.removeChild(slide.parent.body);

					slide.parent.body.appendChild(table);
					parent.appendChild(slide.parent.body);
					var offset = getOffset(slide.body.parentNode);

					Serzone.canvas.style.webkitTransform = "translate(" + (100 - offset.x) + 
						"px, " + (10 - offset.y) + "px)";
				} else {	
					Serzone.canvas.appendChild(slide.body);
					Serzone.canvas.style.webkitTransform = "translate(" + (100 - slide.body.offsetLeft) + 
						"px, " + (10 - slide.body.offsetTop) + "px)";
				}
			} else {
				if (slide.depth > 0) {
					Serzone.canvas.removeChild(slide.parent.body);

					var table = makeIndex(slide, slide.order);
					table.style.webkitTransform = "scale(0.5, 0.5)";
					table.style.webkitTransformOrigin = "left top";
					slide.body.appendChild(table);
					
					table = makeIndex(slide.parent, slide.order);
					slide.parent.body.appendChild(table);
					Serzone.canvas.appendChild(slide.parent.body);

					offset = getOffset(slide.body.parentNode);	
				} else {
					var table = makeIndex(slide, slide.order);
					table.style.webkitTransform = "scale(0.5, 0.5)";
					table.style.webkitTransformOrigin = "left top";

					slide.body.appendChild(table);
					Serzone.canvas.appendChild(slide.body);

					var offset = getOffset(slide.body);	
				}

				Serzone.canvas.style.webkitTransform = "translate(" + (100 - offset.x) + 
					"px, " + (10 - offset.y) + "px)";
			}

			console.log("Slide init");
		},
		fire : function (o) {
			var slide = o.obj;

			if (slide.depth > 0) {
				var parent = slide.parent.body.parentNode;
				parent.removeChild(slide.parent.body);

				var table = makeIndex(slide.parent, slide.order);
				table.style.webkitTransform = "scale(0.5, 0.5)";
				table.style.webkitTransformOrigin = "left top";


				slide.parent.body.appendChild(table);
				parent.appendChild(slide.parent.body);

				var offset = getOffset(slide.parent.body);
				Serzone.canvas.style.webkitTransform = "translate(" + (100 - offset.x) + 
					"px, " + (10 - offset.y) + "px)";
			}
			console.log("Slide fire");
		}
	},


	appear : {
		type : "inherit",
		init : function (o) {
			o.obj.style.color = "white";
			console.log("appear init");
		},
		fire : function (o) {
			o.obj.style.color = "black";
			console.log("appear fire");		
		}
	},

	test : {
		type : "test",
		init : function (o) {
			console.log("test init");
		},
		fire : function (o) {
			console.log("test fire");
		}
	}
};
</script>

<div id="serzone">

<section>
	<h1>木構造を表現出来るプレゼンテーション作成ツールSerzone.jsの開発</h1>

	<br>
	<br>
	<br>
	<br>
	<p class="r">情報科学類　吉村　優</p>
</section>

<section>
	<h1>概要</h1>

	<p>プレゼンテーション</p>

	<section>
		<h1>プレゼンテーションシステム</h1>
	</section>

	<section>
		<h1>技術</h1>

		<div class="step" action="appear">
			<p>CSS</p>
		</div>
		
		<div class="step" action="appear">
			<p>JavaScript</p>
		</div>

		<section>
			<h1>aueao</h1>
		</section>
	</section>

	<section>
		<h1>hoge</h1>
	</section>

	<section>
		<h1>hoge</h1>
	</section>
</section>

<section>
	<h1>あうえおあう</h1>

</section>

</div>

<script src="js/Serzone.js"></script>
<script>
Serzone.start();
</script>

</body>
</html>
